<!DOCTYPE html>
<html>
<head>
  <meta charset="utf8">
</head>
<body>
  <h1>Simple web client</h1>
  <p>
    Demonstrating the handbrake-js Streaming API
    <input id="submit" type="submit" value="Start an encode">
  </p>
  <table>
    <tr>
      <th>Task</th><th>% Complete</th><th>FPS</th><th>Avg FPS</th><th>ETA</th>
    </tr>
    <tr>
      <td id="task"></td><td id="percent"></td><td id="fps"></td><td id="aFps"></td><td id="eta"></td>
    </tr>
  </table>

  <pre id="log"></pre>

  <script>
  var $ = document.querySelector.bind(document),
      socket = new WebSocket("ws://localhost:4444");
      
  socket.onerror = function(err){
    console.log("error", err);
  };
  socket.onopen = function(){
    console.log("OPEN");
  };
  socket.onmessage = function(e){
    try {
      var data = JSON.parse(e.data);
      if (data.info) {
        $("#log").textContent += data.info + "\n";
      }
      if (data.progress){
        var p = data.progress;
        $("#task").textContent = p.taskNumber + " of " + p.taskCount;
        $("#percent").textContent = p.percentComplete;
        $("#fps").textContent = p.fps;
        $("#aFps").textContent = p.avgFps;
        $("#eta").textContent = p.eta;
      }
    } catch(e){
      console.dir(e.data);
    }
  };
  
  $("#submit").onclick = function(e){
    socket.send(JSON.stringify({ 
      input: "demo.mkv", output: "demo.mp4", preset: "Normal" 
    }));
  }
  window.s = socket;
  </script>
</body>
</html>
